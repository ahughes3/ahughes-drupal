{#
/**
 * @file
 * Theme override to display a view of unformatted rows.
 *
 * Available variables:
 * - title: The title of this group of rows. May be empty.
 * - rows: A list of the view's row items.
 *   - attributes: The row's HTML attributes.
 *   - content: The row's content.
 * - view: The view object.
 * - default_row_class: A flag indicating whether default classes should be
 *   used on rows.
 *
 * @see template_preprocess_views_view_unformatted()
 */
#}

{% embed "@organisms/results-teaser-list/results-teaser-list.twig" %}
  {% block resources_elements %}
    {% for results_teaser in rows %}
      {% set resource_title = results_teaser.content['#row']._entity.title.value %}
      {% set resource_url = path('entity.node.canonical', {'node': results_teaser.content['#row']._entity.id})%}
      {% set resource_date = results_teaser.content['#row']._entity.created.value|date('F j\, Y') %}
      {% set resource_type = results_teaser.content['#row']._entity.type.entity.label %}
      {% if resource_type == 'White Paper' and results_teaser.content['#row']._entity.field_type.value == 'ebook' %}
        {% set resource_type = "Ebook" %}
      {% endif %}
      {% if resource_type == 'Episode' %}
        {% set resource_type = "Podcast" %}
      {% endif %}

      {% set resource_episode ='' %}
      {% set resource_author_name = '' %}
      {% set resource_authors = [] %}
      {% if results_teaser.content['#row']._entity.bundle == 'episode' and results_teaser.content['#row']._entity.field_episode_number.value is not empty %}
        {% set resource_episode = results_teaser.content['#row']._entity.field_episode_number.value %}
      {% endif %}
      {% if results_teaser.content['#row']._entity.field_authors.entity.id is not empty %}
        {% for author in results_teaser.content['#row']._entity.field_authors %}
          {% set resource_authors = resource_authors|merge([{
            name: author.entity.label,
            url: path('entity.node.canonical', {'node': author.entity.id}),
          }]) %}
        {% endfor %}
        {% set resource_author_name = results_teaser.content['#row']._entity.field_authors.entity.label %}
        {% set resource_author_link = path('entity.node.canonical', {'node': results_teaser.content['#row']._entity.field_authors.entity.id}) %}
      {% endif %}
      {% set resource_description = results_teaser.content['#row']._entity.field_deck.value %}
      {% set resource_topics = [] %}
      {% for topic in results_teaser.content['#row']._entity.field_topics %}
        {% set resource_topics = resource_topics|merge([{'title': topic.entity.label, 'url': path('entity.node.canonical', {'node':topic.entity.id})}]) %}
      {% endfor %}
      {% embed "@molecules/results-teaser/results-teaser.twig" with {
        results_teaser__title: resource_title,
        results_teaser__url: resource_url,
        results_teaser__date: resource_date,
        results_teaser__type: resource_type,
        results_teaser__episode: resource_episode,
        results_teaser__authors: resource_authors,
        results_teaser__description: resource_description,
        results_teaser__topics_list: resource_topics
      } %}
      {% endembed %}
    {% endfor %}
  {% endblock %}
{% endembed %}
